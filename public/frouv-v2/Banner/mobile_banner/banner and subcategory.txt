
// "use client"

// import Image from "next/image"
// import { useEffect, useRef } from "react"

// // Use direct paths from public folder to avoid Next.js Image Optimization API issues
// const images = [
//   "/landing/Banner/Banner_1.png",
//   "/landing/Banner/Banner_2.png",
//   "/landing/Banner/Banner_3.png",
//   "/landing/Banner/Banner_4.png",
//   "/landing/Banner/Banner_5.png",
//   "/landing/Banner/Banner_6.png",
//   "/landing/Banner/Banner_7.png",
//   "/landing/Banner/Banner_8.png",
// ]

// export default function HeroBanner() {
//   const sliderRef = useRef<HTMLDivElement | null>(null)
//   const indexRef = useRef(0)
//   const isInteracting = useRef(false)

//   useEffect(() => {
//     const interval = setInterval(() => {
//       if (!sliderRef.current || isInteracting.current) return

//       indexRef.current =
//         (indexRef.current + 1) % images.length

//       sliderRef.current.scrollTo({
//         left: indexRef.current * sliderRef.current.clientWidth,
//         behavior: "smooth",
//       })
//     }, 6000)

//     return () => clearInterval(interval)
//   }, [])

//   return (
//     <section className="w-full h-[250px] lg:h-screen overflow-hidden">
//       <div
//         ref={sliderRef}
//         className="
//           flex h-full w-full
//           overflow-x-scroll
//           snap-x snap-mandatory
//           scroll-smooth
//           no-scrollbar
//         "
//         onMouseDown={() => (isInteracting.current = true)}
//         onMouseUp={() => (isInteracting.current = false)}
//         onTouchStart={() => (isInteracting.current = true)}
//         onTouchEnd={() => (isInteracting.current = false)}
//       >
//         {images.map((img, index) => (
//           <div
//             key={index}
//             className="relative min-w-full h-full snap-center"
//           >
//             <Image
//               src={img}
//               alt={`banner-${index}`}
//               fill
//               priority={index === 0}
//               className="object-fill"
//               unoptimized
//             />
//           </div>
//         ))}
//       </div>
//     </section>
//   )
// }



"use client"

import Image from "next/image"
import { useEffect, useRef } from "react"

/* ---------- DESKTOP IMAGES ---------- */
const desktopImages = [
  "/landing/Banner/Banner_1.png",
  "/landing/Banner/Banner_2.png",
  "/landing/Banner/Banner_3.png",
  "/landing/Banner/Banner_4.png",
  "/landing/Banner/Banner_5.png",
  "/landing/Banner/Banner_6.png",
  "/landing/Banner/Banner_7.png",
  "/landing/Banner/Banner_8.png",

]

/* ---------- MOBILE IMAGES ---------- */
const mobileImages = [
  "/landing/Banner/mobile_banner/1st_banner.png",
  "/landing/Banner/mobile_banner/2nd_banner.png",
  "/landing/Banner/mobile_banner/3rd_banner.png",
  "/landing/Banner/mobile_banner/4th_banner.png",
  "/landing/Banner/mobile_banner/5th_banner.png",
  "/landing/Banner/mobile_banner/6th_banner.png",
  "/landing/Banner/mobile_banner/7th_banner.png",
  "/landing/Banner/mobile_banner/8th_banner.png",
]

export default function HeroBanner() {
  const desktopRef = useRef<HTMLDivElement | null>(null)
  const mobileRef = useRef<HTMLDivElement | null>(null)

  const isInteracting = useRef(false)
  const desktopIndex = useRef(1)
  const mobileIndex = useRef(1)

  /* Duplicate slides for infinite effect */
  const desktopSlides = [
    desktopImages[desktopImages.length - 1],
    ...desktopImages,
    desktopImages[0],
  ]

  const mobileSlides = [
    mobileImages[mobileImages.length - 1],
    ...mobileImages,
    mobileImages[0],
  ]

  /* ---------- INFINITE AUTO SLIDE ---------- */
  useEffect(() => {
    const interval = setInterval(() => {
      if (isInteracting.current) return

      /* Desktop */
      if (desktopRef.current) {
        desktopIndex.current += 1
        desktopRef.current.scrollTo({
          left:
            desktopIndex.current *
            desktopRef.current.clientWidth,
          behavior: "smooth",
        })
      }

      /* Mobile */
      if (mobileRef.current) {
        mobileIndex.current += 1
        mobileRef.current.scrollTo({
          left:
            mobileIndex.current *
            mobileRef.current.clientWidth,
          behavior: "smooth",
        })
      }
    }, 6000)

    return () => clearInterval(interval)
  }, [])

  /* ---------- RESET POSITION SILENTLY ---------- */
  const handleDesktopScrollEnd = () => {
    if (!desktopRef.current) return

    const slideWidth = desktopRef.current.clientWidth

    if (desktopIndex.current === desktopSlides.length - 1) {
      desktopIndex.current = 1
      desktopRef.current.scrollTo({
        left: slideWidth,
        behavior: "auto",
      })
    }

    if (desktopIndex.current === 0) {
      desktopIndex.current = desktopSlides.length - 2
      desktopRef.current.scrollTo({
        left:
          desktopIndex.current * slideWidth,
        behavior: "auto",
      })
    }
  }

  const handleMobileScrollEnd = () => {
    if (!mobileRef.current) return

    const slideWidth = mobileRef.current.clientWidth

    if (mobileIndex.current === mobileSlides.length - 1) {
      mobileIndex.current = 1
      mobileRef.current.scrollTo({
        left: slideWidth,
        behavior: "auto",
      })
    }

    if (mobileIndex.current === 0) {
      mobileIndex.current = mobileSlides.length - 2
      mobileRef.current.scrollTo({
        left:
          mobileIndex.current * slideWidth,
        behavior: "auto",
      })
    }
  }

  return (
    <>
      {/* ================= DESKTOP ================= */}
      <section className="hidden lg:block w-full h-screen overflow-hidden">
        <div
          ref={desktopRef}
          className="
            flex h-full w-full
            overflow-x-scroll
            snap-x snap-mandatory
            no-scrollbar
          "
          onScrollEnd={handleDesktopScrollEnd}
          onMouseDown={() => (isInteracting.current = true)}
          onMouseUp={() => (isInteracting.current = false)}
          onTouchStart={() => (isInteracting.current = true)}
          onTouchEnd={() => (isInteracting.current = false)}
        >
          {desktopSlides.map((img, index) => (
            <div
              key={index}
              className="relative min-w-full h-full snap-center"
            >
              <Image
                src={img}
                alt={`desktop-banner-${index}`}
                fill
                priority={index === 1}
                className="object-fill"
                unoptimized
              />
            </div>
          ))}
        </div>
      </section>

      {/* ================= MOBILE ================= */}
      <section className="lg:hidden w-full flex justify-center">
        <div
          ref={mobileRef}
          className="
            flex
            w-[380px] h-[185px]
            overflow-x-scroll
            snap-x snap-mandatory
            no-scrollbar
          "
          onScrollEnd={handleMobileScrollEnd}
          onTouchStart={() => (isInteracting.current = true)}
          onTouchEnd={() => (isInteracting.current = false)}
        >
          {mobileSlides.map((img, index) => (
            <div
              key={index}
              className="relative min-w-full h-full snap-center"
            >
              <Image
                src={img}
                alt={`mobile-banner-${index}`}
                fill
                priority={index === 1}
                className="object-cover "
                unoptimized
              />
            </div>
          ))}
        </div>
      </section>
    </>
  )
}





//product grid

"use client"

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { AiFillStar, AiOutlineHeart, AiFillHeart } from 'react-icons/ai'
import { addToCart, addToWishlist, removeFromWishlist } from '@/lib/actions/user-actions'
import WishlistButton from '@/components/WishlistButton'
import Card from '@/components/ui/Card'

interface Product {
  id: string
  name: string
  image: string
  rating: number
  reviews: number
  originalPrice: number
  discountedPrice: number
  savings: number
  brand: string | null
  availableQuantity: number
}

interface ProductGridProps {
  products: Product[]
  user: { id: string; role: string } | null
}

export default function ProductGrid({ products, user }: ProductGridProps) {
  const router = useRouter()
  const [addingToCart, setAddingToCart] = useState<string | null>(null)

  const handleAddToCart = async (productId: string) => {
    if (!user || user.role !== 'USER') {
      router.push('/user/login')
      return
    }

    setAddingToCart(productId)
    try {
      const formData = new FormData()
      formData.append('productId', productId)
      formData.append('quantity', '1')
      await addToCart(formData)
      router.refresh()
    } catch (error) {
      console.error('Failed to add to cart:', error)
      alert('Failed to add product to cart')
    } finally {
      setAddingToCart(null)
    }
  }

  return (
    <div className="grid gap-4 sm:gap-4 lg:gap-6 grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
      {products.map((product) => (
        <Card 
          key={product.id} 
          hover 
          className="overflow-hidden flex flex-col group relative bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 hover:border-[#8BC34A]/30"
        >
          {/* Wishlist Button - Always Visible, Top Right */}
          <div className="absolute top-3 right-3 z-10">
            <div onClick={(e) => e.stopPropagation()}>
              <WishlistButton
                productId={product.id}
                user={user}
                className="cursor-pointer hover:scale-110 transition-transform bg-white/95 backdrop-blur-sm rounded-full p-2 shadow-lg border border-gray-200 hover:border-[#8BC34A]"
                size={20}
              />
            </div>
          </div>

          {/* Product Image - Large Square */}
          <Link href={`/product-detail/${product.id}`} className="block">
            <div className="relative bg-gradient-to-br from-gray-50 to-gray-100 aspect-square overflow-hidden">
              {product.image ? (
                <img
                  src={product.image || "/placeholder.svg"}
                  alt={product.name}
                  className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                  width={400}
                  height={400}
                  loading="lazy"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center bg-gray-100">
                  <svg className="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
              )}
              {/* Stock Badge */}
              {(product.availableQuantity || 0) === 0 && (
                <div className="absolute top-3 left-3 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow-md">
                  Out of Stock
                </div>
              )}
            </div>
          </Link>

          {/* Product Info */}
          <div className="p-5 flex-1 flex flex-col">
            {/* Brand */}
            {product.brand && (
              <p className="text-[10px] text-gray-500 mb-1.5 font-semibold uppercase tracking-wider">
                {product.brand}
              </p>
            )}

            {/* Product Name - Smaller */}
            <Link href={`/product-detail/${product.id}`}>
              <h3 className="text-sm font-medium text-gray-800 mb-2.5 line-clamp-2 min-h-[2.25rem] group-hover:text-[#689f38] transition-colors leading-snug">
                {product.name}
              </h3>
            </Link>

            {/* Rating */}
            {product.reviews > 0 && (
              <div className="flex items-center gap-1.5 mb-3">
                <div className="flex items-center gap-0.5 bg-[#FFF9E6] px-1.5 py-0.5 rounded-md">
                  <AiFillStar className="h-3.5 w-3.5 text-[#F6C44C]" aria-hidden />
                  <span className="text-xs font-semibold text-gray-900">{product.rating.toFixed(1)}</span>
                </div>
                <span className="text-gray-300">•</span>
                <span className="text-xs text-gray-500">{product.reviews} {product.reviews === 1 ? 'Review' : 'Reviews'}</span>
              </div>
            )}

            {/* Price Section */}
            <div className="flex flex-wrap items-baseline gap-2 mb-4">
              <span className="text-[18px] font-medium text-gray-900">₹{product.discountedPrice}</span>
              {product.originalPrice > product.discountedPrice && (
                <>
                  <span className="text-sm text-gray-400 line-through">₹{product.originalPrice}</span>
                  {product.savings > 0 && (
                    <span className="text-[10px] font-bold text-[#167A3A] bg-[#ECF8D9] px-2 py-1 rounded-md">
                      Save ₹{product.savings}
                    </span>
                  )}
                </>
              )}
            </div>

            {/* Add to Cart Button */}
            <button
              onClick={(e) => {
                e.stopPropagation()
                handleAddToCart(product.id)
              }}
              disabled={addingToCart === product.id || (product.availableQuantity || 0) === 0}
              className="mt-auto w-full rounded-lg bg-gradient-to-r from-[#8BC34A] to-[#689f38] px-4 py-2.5 text-center text-sm font-semibold text-white transition-all hover:from-[#689f38] hover:to-[#558b2f] disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg disabled:shadow-none transform hover:scale-[1.02] active:scale-[0.98]"
              aria-label={`Add ${product.name} to cart`}
            >
              {addingToCart === product.id 
                ? (
                  <span className="flex items-center justify-center gap-2">
                    <svg className="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Adding...
                  </span>
                )
                : (product.availableQuantity || 0) === 0 
                  ? 'Out of Stock' 
                  : 'Add to Cart'}
            </button>
          </div>
        </Card>
      ))}
    </div>
  )
}
